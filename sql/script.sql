drop database if exists RPG_telegrambot;
CREATE DATABASE RPG_telegrambot;
drop schema if exists public cascade;
drop schema if exists fixed cascade;
CREATE SCHEMA public;
CREATE SCHEMA fixed;

CREATE TABLE fixed.class
(
    id             serial PRIMARY KEY,
    name           text,
    description    text,
    required_level bigint,
    base_class     bigint references fixed.class (id)
);

CREATE TABLE fixed.skill
(
    id           serial PRIMARY KEY,
    name         text,
    class_id     bigint references fixed.class (id),
    damage_bonus bigint,
    armor_bonus  bigint,
    health_bonus bigint,
    mana_bonus   bigint
);

CREATE TABLE fixed.solo_activity
(
    id                serial PRIMARY KEY,
    name              text,
    state_name        text,
    description       text,
    required_level    bigint,
    required_stamina  bigint,
    activity_duration bigint
);
CREATE TABLE fixed.raid_boss
(
    id                serial PRIMARY KEY,
    name              text,
    life              bigint,
    damage            bigint,
    armor             bigint,
    recommended_level bigint,
    stamina_required  bigint,
    gold_reward       bigint,
    exp_reward        bigint
);
CREATE TABLE public.party
(
    id            serial primary key,
    name          TEXT UNIQUE,
    boss_fighting bigint references fixed.raid_boss (id),
    boss_life     bigint
);

CREATE TABLE public.usr
(
    chat_id         bigint PRIMARY KEY,
    name            TEXT,
    level           bigint,
    passive_points  bigint,
    current_health  bigint,
    max_health      bigint,
    current_stamina bigint,
    max_stamina     bigint,
    current_mana    bigint,
    max_mana        bigint,
    user_state      integer,
    activity_ends   TIMESTAMP,
    activity_id     bigint references fixed.solo_activity (id),
    stamina_restor  TIMESTAMP,
    partner_chat_id bigint references public.usr (chat_id),
    class_id        bigint references fixed.class (id),
    party_id        bigint references public.party (id),
    host_party_id   bigint references public.party (id),
    gold            bigint,
    exp             bigint,
    is_game_master  boolean,
    offline_points  bigint
);

CREATE TABLE public.applied_skill
(
    id          serial PRIMARY KEY,
    skill_id    bigint references fixed.skill (id),
    user_id     bigint references public.usr (chat_id),
    skill_level bigint
);

CREATE TABLE fixed.base_item
(
    id                serial PRIMARY KEY,
    name              text,
    description       text,
    damage            bigint,
    armor             bigint,
    type              bigint,
    max_in_stack      bigint,
    is_for_sale       boolean,
    class_required_id bigint references fixed.class (id) default (1),
    buy_price         bigint
);
CREATE TABLE fixed.base_item_craft
(
    id                    serial PRIMARY KEY,
    crafted_base_item_id  bigint references fixed.base_item (id),
    material_base_item_id bigint references fixed.base_item (id),
    countOfMaterial       bigint
);
CREATE TABLE fixed.consumable_item_effect
(
    id           serial PRIMARY KEY,
    base_item_id bigint references fixed.base_item (id),
    add_life     bigint,
    add_mana     bigint,
    add_stamina  bigint
);

CREATE TABLE fixed.solo_activity_reward
(
    id               serial PRIMARY KEY,
    solo_activity_id bigint references fixed.solo_activity (id),
    gold_reward      bigint,
    exp_reward       bigint,
    item_reward      bigint references fixed.base_item (id),
    result_message   text
);



CREATE TABLE fixed.raid_boss_item_reward
(
    id      serial PRIMARY KEY,
    boss_id bigint references fixed.raid_boss (id),
    item_id bigint references fixed.base_item (id)
);

CREATE TABLE public.ingame_item
(
    id             serial PRIMARY KEY,
    item_id        bigint references fixed.base_item (id),
    items_in_stack bigint,
    user_id        bigint not null references public.usr (chat_id),
    is_equipped    boolean,
    sharpness      bigint
);



CREATE TABLE public.fight
(
    id          serial primary key,
    user1_id    bigint references public.usr (chat_id),
    user2_id    bigint references public.usr (chat_id),
    fight_state TEXT
);


CREATE TABLE public.move
(
    id         serial primary key,
    user_id    bigint references public.usr (chat_id),
    fight_id   bigint references public.fight (id),
    defense    int,
    attack     int,
    move_state int,
    hp         bigint,
    end_time   timestamp,
    num        bigint
);


CREATE TABLE public.group_chat
(
    id           bigint primary key,
    user_invited bigint references public.usr (chat_id)
);

CREATE TABLE public.offline_event
(
    id                    serial primary key,
    creator               bigint references public.usr (chat_id),
    event_name            text,
    event_goal            text,
    offline_points_reward bigint,
    event_type            bigint,
    event_state           integer
);



insert into fixed.class(name, description, required_level, base_class)
VALUES ('‚öí –†–∞–±–æ—Ç—è–≥–∞', '–û–±—ã—á–Ω—ã–π —Ä–∞–±–æ—Ç—è–≥–∞ –±–µ–∑ –∫–∞–∫–∏—Ö –ª–∏–±–æ –±–æ–Ω—É—Å–æ–≤.', 1, null);
insert into fixed.class(name, description, required_level, base_class)
VALUES ('‚öî –í–æ–∏–Ω', '–ë–æ–µ—Ü. –£–º–µ–ª–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è —Å —Ö–æ–ª–æ–¥–Ω—ã–º –æ—Ä—É–∂–∏–µ–º –≤—Å–µ—Ö –≤–∏–¥–æ–≤.', 7, 1);
insert into fixed.class(name, description, required_level, base_class)
VALUES ('‚öî –ë–µ—Ä—Å–µ—Ä–∫', '–ñ–∞–¥–Ω—ã–π –¥–æ –∫—Ä–æ–≤–∏ –≤–æ–∏–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–µ, –Ω–æ –±–µ—Å–ø–æ—â–∞–¥–Ω—ã–µ –∏ —Å–æ–∫—Ä—É—à–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ç–∞–∫–∏.', 15, 2);
insert into fixed.class(name, description, required_level, base_class)
VALUES ('üèπ –†–µ–π–Ω–¥–∂–µ—Ä', '–õ–æ–≤–∫–∏–π —Å—Ç—Ä–∞–Ω–Ω–∏–∫. –í–ª–∞–¥–µ–µ—Ç –Ω–∞–≤—ã–∫–∞–º–∏ —Å—Ç—Ä–µ–ª—å–±—ã –∏–∑ –ª—É–∫–∞ –∏ –≤—Å–µ–≥–¥–∞ –Ω–æ—Å–∏—Ç —Å —Å–æ–±–æ–π –ø–∞—Ä—É –∫–∏–Ω–∂–∞–ª–æ–≤.', 7, 1);


insert into fixed.skill(name, class_id, damage_bonus, armor_bonus, health_bonus, mana_bonus)
VALUES ('–ë–∞–∑–æ–≤–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –æ—Ä—É–∂–∏–µ–º.', 1, 1, 0, 0, 0),
       ('–ë–∞–∑–æ–≤–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–µ–π.', 1, 0, 1, 0, 0),
       ('–ü–æ–≤—ã—à–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è.', 1, 0, 0, 5, 0),
       ('–ü–æ–≤—ã—à–µ–Ω–∏–µ –º–∞–Ω—ã.', 1, 0, 0, 0, 5),
       ('–ñ–∏–≤—É—á–µ—Å—Ç—å –≤–æ–∏–Ω–∞.', 2, 0, 1, 5, 0),
       ('–£–ª—É—á—à–µ–Ω–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–µ–π.', 2, 0, 2, 0, 0);



insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–µ—á', '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –º–µ—á, –ø–æ–±–µ–¥–∏—Ç—å –∫–æ–≥–æ —Å –Ω–∏–º –Ω–∞—Å—Ç–æ—è—â–∞—è —É–¥–∞—á–∞.', 2, null, 0, null, 15, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale, class_required_id)
VALUES ('–°—Ç–∞—Ä—ã–π –∂–µ–ª–µ–∑–Ω—ã–π –º–µ—á', '–°—Ç–∞—Ä—ã–π –∂–µ–ª–µ–∑–Ω—ã–π –º–µ—á, –Ω–µ–º–Ω–æ–≥–æ –æ—Å—Ç—Ä—ã–π.', 2, null, 0, null, 15, true, 2);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π —â–∏—Ç', '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π —â–∏—Ç, –ø–æ–±–µ–¥–∏—Ç—å –∫–æ–≥–æ —Å –Ω–∏–º –Ω–∞—Å—Ç–æ—è—â–∞—è —É–¥–∞—á–∞.', null, 2, 2, null, 15, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–ö–∞–º–µ–Ω—å', '–û–±—ã—á–Ω—ã–π –∫–∞–º–µ–Ω—å —á—Ç–æ–±—ã —á—Ç–æ —Ç–æ —Å–¥–µ–ª–∞—Ç—å', null, null, 8, 25, 15, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–ü–∞–ª–∫–∞', '–û–±—ã—á–Ω–∞—è –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –ø–∞–ª–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤.', null, null, 8, 25, 15, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–ü–æ—Å–æ—Ö', '–û–±—ã—á–Ω–∞—è –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –ø–∞–ª–∫–∞ –¥–ª—è —É–±–∏–π—Å—Ç–≤–∞ –ª—é–¥–µ–π.', 1, null, 1, null, 25, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–ö–æ–∂–∞–Ω—ã–π —à–ª–µ–º', '.', null, 2, 5, null, 15, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–¢–æ—á–∏–ª—å–Ω—ã–π –∫–∞–º–µ–Ω—å', '–° –µ–≥–æ –ø–æ–º–æ—â—å—é –º–æ–∂–Ω–æ –∑–∞—Ç–æ—á–∏—Ç—å –æ—Ä—É–∂–∏–µ –∏–ª–∏ –¥–æ—Å–ø–µ—Ö–∏.', null, null, 9, 25, 50, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–ú–∞–ª–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 50 –∑–¥–æ—Ä–æ–≤—å—è.', null, null, 7, 5, 50, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ 0.25', '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 1 –µ–¥. –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏.', null, null, 7, 5, 50, true);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–î—Ä–∞–∫–æ–ª–∏—Ç', '–†—É–¥–∞.', null, null, 8, 15, 50, false);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–î—Ä–µ–≤–Ω–∏–π –∫–∞–º–µ–Ω—å', '–ö–∞–º–µ–Ω—å.', null, null, 8, 15, 50, false);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–î—É—à–∞', '–î—É—à–∞ –î—Ä–µ–≤–Ω–µ–≥–æ –î—Ä–∞–∫–æ–Ω–∏–¥–∞.', null, null, 8, 15, 50, false);
insert into fixed.base_item
(name, description, damage, armor, type, max_in_stack, buy_price, is_for_sale)
VALUES ('–ö—Ä–æ–≤—å –¥—Ä–∞–∫–æ–Ω–∏–¥–∞', '–ö—Ä–æ–≤—å –î—Ä–µ–≤–Ω–µ–≥–æ –î—Ä–∞–∫–æ–Ω–∏–¥–∞.', null, null, 8, 15, 50, false);

insert into fixed.consumable_item_effect
    (base_item_id, add_life, add_mana, add_stamina)
VALUES (9, 50, 0, 0),
       (10, 0, 0, 1);

insert into fixed.solo_activity(name, state_name, description, required_level, required_stamina, activity_duration)
values ('–†—É–∏–Ω—ã',
        '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä—É–∏–Ω',
        '–ó–∞–±—Ä–æ—à–µ–Ω—ã–µ —Ä—É–∏–Ω—ã –Ω–µ–¥–∞–ª–µ–∫–æ –æ—Ç –≥–æ—Ä–æ–¥–∞. –ß–µ–≥–æ-—Ç–æ —Ä–µ–¥–∫–æ–≥–æ —Ç–∞–º –Ω–µ –Ω–∞–π–¥–µ—à—å, –Ω–æ –Ω–∞–±–µ—Ä–µ—à—å—Å—è –æ–ø—ã—Ç–∞ –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π –∏, –µ—Å–ª–∏ –ø–æ–≤–µ–∑–µ—Ç, –ø–∞—Ä—É –º–æ–Ω–µ—Ç.',
        1, 1, 1),
       ('–ú—É–∑–µ–π –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞',
        '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º—É–∑–µ—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞',
        '–ú—É–∑–µ–π –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–µ—Å—Ç–µ—Ä–æ–≤—â–∏–∫–∞ –û–≠–ó. –ì–æ–≤–æ—Ä—è—Ç —Ç–∞–º –æ—Å—Ç–∞–ª–æ—Å—å –º–Ω–æ–≥–æ –¥–µ–Ω–µ–≥.',
        5, 1, 2);

insert into fixed.solo_activity_reward(solo_activity_id, gold_reward, exp_reward, item_reward, result_message)
values (1, 2, 3, null, '–¢—ã –ø–æ–±—Ä–æ–¥–∏–ª –ø–æ —Ä—É–∏–Ω–∞–º –ø–∞—Ä—É —á–∞—Å–æ–≤, –±—ã–ª–æ –æ—á–µ–Ω—å —Å–∫—É—á–Ω–æ.');
insert into fixed.solo_activity_reward(solo_activity_id, gold_reward, exp_reward, item_reward, result_message)
values (2, 8, 10, 10, '–¢—ã –æ–±—à–∞—Ä–∏–ª —Å—Ç–∞—Ä—ã–π –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –º—É–∑–µ–π, —Ç–µ–±–µ –ø–æ–≤–µ–∑–ª–æ –Ω–∞–π—Ç–∏ *–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ 0.25*.');
insert into fixed.solo_activity_reward(solo_activity_id, gold_reward, exp_reward, item_reward, result_message)
values (2, 8, 10, null,
        '–¢—ã –æ–±—à–∞—Ä–∏–ª —Å—Ç–∞—Ä—ã–π –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –º—É–∑–µ–π, —Ç–∞–º –¥–∞–≤–Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ —É–±–∏—Ä–∞–ª—Å—è, –Ω–æ –Ω–∏—á–µ–≥–æ –∫—Ä–æ–º–µ –ø–∞—Ä—ã –º–æ–Ω–µ—Ç –Ω–µ –Ω–∞—à–µ–ª.');

insert into fixed.raid_boss (name, life, damage, armor, recommended_level, gold_reward, exp_reward, stamina_required)
VALUES ('–î—Ä–µ–≤–Ω–∏–π –î—Ä–∞–∫–æ–Ω–∏–¥', 1000, 50, 40, 10, 100, 150, 5);
insert into fixed.raid_boss_item_reward (boss_id, item_id)
values (1, 11),(1, 13),(1, 13),(1, 14);



insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (1, null, 1436473525, false, 10000);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (2, null, 1436473525, false, 0);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (3, null, 1436473525, false, 0);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (4, 1, 1436473525, false, null);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (5, 1, 1436473525, false, null);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (6, null, 1436473525, false, 0);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (7, null, 1436473525, false, 1000);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (8, 250, 1436473525, false, null);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (10, 15, 1436473525, false, null);


insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (1, null, 651071979, false, 0);
insert into public.ingame_item(item_id, items_in_stack, user_id, is_equipped, sharpness)
VALUES (8, 250, 935293113, false, null);